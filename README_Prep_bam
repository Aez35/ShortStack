SYNOPSIS
    Input a sam, sam.gz, or bam file sorted by read names, Tally mappings
    per read and note with NH:i: tags, Output a .bam file sorted by
    chromosomal location, and a corresponding .bai index file.

CITATION
    If you use Prep_bam.pl in your work, please cite

    Axtell MJ. (2013) ShortStack: Comprehensive annotation and
    quantification of small RNA genes. RNA. doi:10.1261/rna.035279.112

VERSIONS
    0.1.3 : THIS VERSION. Developed April 12, 2013. First relased April 24,
    2013 with ShortStack 0.4.3.

    0.1.2 : March 18, 2013. Updates to documentation infromation only,
    program itself is the same as 0.1.1. First released with ShortStack
    0.4.2.

    0.1.1 : June 28, 2012. Frist released with ShortStack 0.1.4. Fixes
    program so it no longer breaks when unmapped lines are encountered (now
    it simply ignores them). This also allows direct piping of bowtie data
    directly into Prep_bam.pl

    0.1.0 : Initial release. April 29, 2012

INSTALL
    install samtools from <http://samtools.sourceforge.net/> and ensure that
    samtools is in your PATH

    ensure the script is executable

        chmod +x Prep_bam.pl                                                         
                                                                                                 
    ensure the script is in your PATH (examples):

        sudo cp Prep_bam.pl /usr/bin/                                                
                                                                                                 
    OR just for one session assuming script is in your working directory:

        PATH=$PATH:.                                                                                 
                                                                                                 
    ensure 'perl' is located in /usr/bin/ .. if not, edit line 1 of script
    accordingly

USAGE
    1. For .bam files:

            samtools view [input.bam] | Prep_bam.pl --prefix [prefix] --genome [genome.fasta] --sortmem [INT]                                 

    2. For .sam.gz files:

            gzip -d -c [input.sam.gz] | Prep_bam.pl --prefix [prefix] --genome [genome.fasta] --sortmem [INT]                          

    3. For uncompressed .sam files:

            Prep_bam.pl --prefix [prefix] --genome [genome.fasta] --sortmem [INT] < [input.sam]     

    4. To pipe in bowtie (version 1 e.g. 0.12.x) sam output directly:

            bowtie [bowtie_options] -S [bowtie_index] [trimmed_reads] | Prep_bam.pl --prefix [prefix] --genome [genome] --sortmem [INT]

OPTIONS
    --prefix [string] : base name for the final .bam and .bam.bai files that
    will be created :: REQUIRED

    --genome [string] : Path to the fasta formatted genome file used for the
    mapping :: REQUIRED

    --sortmem [integer] : Amount of memory, in bytes, to allocate to the
    samtools sort function. If not specified, samtools sort defaults to
    500,000,000 (e.g. 476.8Mb). Allocating more memory speeds sorting. ::
    OPTIONAL

NOTES
  Input format and assumptions

    It is critical that the input sam, sam.gz, or bam file be sorted by read
    name. Additionally, it is assumed that read names are unique within the
    file. If either of these assumptions are not true, the results of this
    script are not reliable.

  Exisiting NH:i: tags

    If there are already NH:i: tags in the input data, they will be
    discarded and over-written by the script.

AUTHOR
    Michael J. Axtell, Penn State University, mja18@psu.edu

